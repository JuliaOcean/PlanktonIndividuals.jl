mutable struct Model_Input
    temp::AbstractArray{Float64,4}      # temperature
    PAR::AbstractArray{Float64,3}       # PAR
end

mutable struct velocities
    vel₀::NamedTuple
    vel½::NamedTuple
    vel₁::NamedTuple
end

mutable struct timestepper
    Gcs::NamedTuple
    MD1::NamedTuple
    MD2::NamedTuple
    MD3::NamedTuple
    plk::NamedTuple
    ope::AbstractArray
    par::AbstractArray
    chl::AbstractArray
end

mutable struct Model_Struct
    arch::Architecture          # architecture on which models will run
    t::Int64
    individuals::individuals    # initial individuals generated by `setup_agents`
    nutrients::NamedTuple       # initial nutrient fields
    grid::Grids                 # grid information
    input::Model_Input          # model input, temp and PAR
    params::Dict                # biogeochemical parameter set
    diags::Diagnostics          # diagnostics
    velocities::velocities      # save the velocities of last and current time steps from physical models
    timestepper::timestepper    # operating Tuples and arrays for timestep
end
"""
    PI_model(grid, RunParam)
Generate the model structure for time step
Default distribution of individuals is Normal distribution with 1.0 as mean and 0.25 as SD
Default PAR and temp are from ../samples
"""
function PI_Model(arch::Architecture, grid, RunParam;
                  t = 1-RunParam.ΔT,
                  individuals = gen_agents(arch,RunParam,grid),
                  nutrients,
                  PAR = read_IR_input(RunParam.ΔT, grid),
                  temp = read_temp_input(RunParam.ΔT, grid),
                  params = RunParam.params,
                  diag = diags_setup(arch, RunParam.nTime, RunParam.ΔT, grid, RunParam.params["diag_freq"], RunParam.params["diag_inds"], RunParam.params["P_Nsp"]),
                  diag_tr = diags_setup(arch, RunParam.nTime, RunParam.ΔT, grid, RunParam.params["diag_freq"], 5)
                  )

    if arch == GPUs()
        input = Model_Input(CuArray(temp), CuArray(PAR))
    else
        input = Model_Input(temp,PAR)
    end

    diags = Diagnostics(diag, diag_tr)

    if arch == GPUs() && !has_cuda()
        throw(ArgumentError("Cannot create a GPU model. No CUDA-enabled GPU was detected!"))
    end

    vel = velocities((;),(;),(;))

    Gcs = nutrients_init(arch, grid)
    MD1 = nutrients_init(arch, grid)
    MD2 = nutrients_init(arch, grid)
    MD3 = nutrients_init(arch, grid)
    plk = nutrients_init(arch, grid)
    ope = zeros(Float64, RunParam.params["P_Nind"], 34) |> array_type(arch)
    par = zeros(Float64, grid.Nx, grid.Ny, grid.Nz) |> array_type(arch)
    chl = zeros(Float64, grid.Nx, grid.Ny, grid.Nz) |> array_type(arch)
    ts = timestepper(Gcs, MD1, MD2, MD3, plk, ope, par, chl)

    model = Model_Struct(arch, t, individuals, nutrients, grid, input, params, diags, vel, ts)

    if RunParam.Zoo == true
        model.params["Grz_P"] = 0
    else
        nothing
    end
    return model
end
